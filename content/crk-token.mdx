---
title: "Protecting Your Web Application with CSRF Tokens"
summary: "Learn how to implement CSRF token protection to secure your web application against cross-site request forgery attacks."
publishedAt: "2025-10-07"
tags: "security, csrf, web-development, owasp"
---

# Protecting Your Web Application with CSRF Tokens

I recently worked on integrating a third-party certificate audit API service into our existing application. One of our primary concerns, shared by our customers, was ensuring the security of our public website.

We implemented a feature that allows clients to submit their certificate number for verification. The feature was straightforward - users simply enter a text field with a number as an ID, and if it matches our system, we respond with relevant information. 
![CSRF Token Prevention Flow](/images/certificate-check.png)


## The Security Problem

The web application sends a simple POST request to verify the certificate:

```http
POST https://www.company.com/api/check
Content-Type: application/json
{
  "id": "XWG1000FFHH"
}
```

### The Vulnerability

This approach creates several security vulnerabilities:

1. **Brute Force Attacks**: Attackers can send random requests until they find a valid certificate ID
2. **Malicious Injection**: Without proper validation, malicious payloads could be injected
3. **No Authentication**: Anyone can attempt to access certificate information

> **Security Principle**: As developers, we should maintain a security-first mindset. One of our core principles is: **"Never trust anything exposed to the public."**

## The Solution: CSRF Token Protection

To prevent these security flaws and ensure only legitimate users can check their certificates, we implemented CSRF (Cross-Site Request Forgery) token protection - one of the best practices recommended by OWASP.

### What is a CSRF Token?
![CSRF Token Prevention Flow](/images/csrf-token-prevention.png)

A CSRF token is a long, randomly generated string created on the server-side. It's generated once per user session or for each request, depending on your security requirements.

**CSRF Token Requirements:**
- **Unique per user session** - Each user gets their own token
- **Secret** - Not predictable or guessable by attackers
- **Unpredictable** - Large random value generated using secure cryptographic methods
- **Time-limited** - Tokens should expire after a reasonable time period

### Implementation Example

Here's how we implemented CSRF protection in our form:

```html
<form action="/check.do" method="post">
  <input type="text" name="certificate-id" placeholder="Enter certificate ID" />
  <input type="hidden" name="csrf-token" value="OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZMGYwMGEwOA==" />
  <button type="submit">Verify Certificate</button>
</form>
```

Now our API request includes the CSRF token:

```json
payload:
{
  "id": "XWG1000FFHH",
  "csrf": "OWY4NmQwODE4ODRjN2Q2NTlhMmZlYWEwYzU1YWQwMTVhM2JmNGYxYjJiMGI4MjJjZDE1ZDZMGYwMGEwOA=="
}
```

### How It Works

1. **Token Generation**: When a user visits the page, the server generates a unique CSRF token
2. **Token Storage**: The token is stored in the user's session and embedded in the form
3. **Request Validation**: When the form is submitted, the server validates that the token matches the one in the user's session
4. **Attack Prevention**: Attackers cannot forge requests because they don't have access to the user's session token

Most modern web frameworks handle CSRF token validation automatically in their middleware, making implementation straightforward.

## Additional Security Considerations

While CSRF tokens provide excellent protection against cross-site request forgery, consider implementing these additional security measures:

1. **Rate Limiting**: Implement rate limiting to prevent brute force attacks
2. **Input Validation**: Validate and sanitize all input data
3. **HTTPS Only**: Ensure all communications use HTTPS
4. **Session Management**: Implement proper session timeout and invalidation
5. **Logging and Monitoring**: Monitor for suspicious activity and failed attempts

## Conclusion

Implementing CSRF token protection is a crucial step in securing web applications. By following OWASP guidelines and implementing proper token validation, we can significantly reduce the risk of unauthorized access and malicious attacks.

Remember: **Security is not a one-time implementation but an ongoing process.** Regular security audits, updates, and monitoring are essential to maintain a secure application.

## References

- [OWASP CSRF Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
- [OWASP Top 10 Web Application Security Risks](https://owasp.org/www-project-top-ten/)





